Description: Have gn use pkg-config to make swiftshader depend on x11-xcb,
 so that it is able to find it in non-standard locations,
 such as where the gnome-3-38-2004-sdk snap exposes it.
Forwarded: not-yet
Author: Olivier Tilloy <olivier.tilloy@canonical.com>

--- a/third_party/swiftshader/src/WSI/BUILD.gn
+++ b/third_party/swiftshader/src/WSI/BUILD.gn
@@ -21,6 +21,12 @@ config("WSI_metal_weak_framework") {
       "Metal",
     ]
   }
+  if (is_linux) {
+    import("//build/config/linux/pkg_config.gni")
+    pkg_config("x11-xcb") {
+      packages = [ "x11-xcb" ]
+    }
+  }
 }
 
 swiftshader_source_set("WSI") {
@@ -75,4 +81,8 @@ swiftshader_source_set("WSI") {
   ]
 
   configs = [ "../Vulkan:swiftshader_libvulkan_private_config" ]
+
+  if (is_linux) {
+    configs += [ ":x11-xcb" ]
+  }
 }
--- a/third_party/swiftshader/src/Vulkan/BUILD.gn
+++ b/third_party/swiftshader/src/Vulkan/BUILD.gn
@@ -57,6 +57,13 @@ config("swiftshader_libvulkan_private_co
   defines += [
      "SWIFTSHADER_ENABLE_ASTC",  # TODO(b/150130101)
   ]
+
+  if (is_linux) {
+    import("//build/config/linux/pkg_config.gni")
+    pkg_config("x11-xcb") {
+      packages = [ "x11-xcb" ]
+    }
+  }
 }
 
 swiftshader_source_set("swiftshader_libvulkan_headers") {
@@ -210,6 +217,10 @@ swiftshader_shared_library("swiftshader_
   public_deps = [
     ":swiftshader_libvulkan_headers",
   ]
+
+  if (is_linux) {
+    configs += [ ":x11-xcb" ]
+  }
 }
 
 # Generates an ICD JSON file that can be used by all targets in this GN build
